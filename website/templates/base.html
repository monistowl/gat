<!DOCTYPE html>
<html lang="{{ config.default_language }}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}{{ config.title }}{% endblock title %}</title>
  <meta name="description" content="{% block description %}{{ config.description }}{% endblock description %}" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- KaTeX for math rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          }
        }
      }
    }
  </script>

  <!-- Theme System: CSS Variables that respond to light/dark toggle -->
  <style>
    /* Light theme (default) */
    :root {
      --c1: #ffffff;           /* Primary background */
      --c2: #f8fafc;           /* Secondary background (cards, code) */
      --c3: #e2e8f0;           /* Borders */
      --c4: #64748b;           /* Muted text */
      --f1: #1e293b;           /* Primary text */
      --f2: #0f172a;           /* Heading text */
      --a1: #ea580c;           /* Accent color (orange-600) */
      --a1-hover: #c2410c;     /* Accent hover (orange-700) */
      --code-bg: #f1f5f9;      /* Code block background */
      --code-text: #c2410c;    /* Inline code text */
      --grid-color: #cbd5e1;   /* Background grid */
      --selection-bg: rgba(234, 88, 12, 0.2);
    }

    /* Dark theme */
    [data-theme="dark"], .dark {
      --c1: #020617;           /* slate-950 */
      --c2: #0f172a;           /* slate-900 */
      --c3: #1e293b;           /* slate-800 */
      --c4: #94a3b8;           /* slate-400 */
      --f1: #e2e8f0;           /* slate-200 */
      --f2: #ffffff;           /* white */
      --a1: #fb923c;           /* orange-400 */
      --a1-hover: #fdba74;     /* orange-300 */
      --code-bg: #0f172a;      /* slate-900 */
      --code-text: #fb923c;    /* orange-400 */
      --grid-color: #334155;   /* slate-700 */
      --selection-bg: rgba(251, 146, 60, 0.3);
    }

    /* Smooth scroll behavior */
    html {
      scroll-behavior: smooth;
    }

    body {
      min-height: 100vh;
      background-color: var(--c1);
      color: var(--f1);
      font-family: 'Inter', system-ui, sans-serif;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    ::selection {
      background: var(--selection-bg);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(1.02); }
      to { opacity: 1; transform: scale(1); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes slideInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-slideInUp {
      animation: slideInUp 0.6s ease-out;
    }

    /* Enhanced card hover effects */
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(251, 146, 60, 0.1),
                  0 10px 10px -5px rgba(251, 146, 60, 0.05);
    }
    .card-hover:hover .card-icon {
      transform: scale(1.1);
      border-color: rgba(251, 146, 60, 0.5);
    }
    .card-icon {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Code highlighting - theme-aware */
    pre {
      background-color: var(--code-bg);
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      border: 1px solid var(--c3);
      max-width: 100%;
      white-space: pre;
    }
    code {
      font-size: 0.875rem;
      font-family: 'JetBrains Mono', monospace;
    }
    pre code {
      color: var(--f1);
      white-space: inherit;
    }
    :not(pre) > code {
      background-color: var(--code-bg);
      padding: 0.125rem 0.5rem;
      border-radius: 0.25rem;
      color: var(--code-text);
    }

    /* Ensure prose code blocks are contained and scrollable */
    .prose pre {
      max-width: 100%;
      overflow-x: auto;
    }
    .prose {
      overflow-wrap: break-word;
      word-wrap: break-word;
      min-width: 0;
    }
    /* Mobile-specific overflow handling */
    @media (max-width: 640px) {
      .prose h1 {
        font-size: 1.75rem;
        word-break: break-word;
      }
      .prose h2 {
        font-size: 1.5rem;
        word-break: break-word;
      }
      .prose h3 {
        font-size: 1.25rem;
      }
      .prose pre {
        font-size: 0.75rem;
        padding: 0.75rem;
      }
      .katex-display {
        padding: 0.5rem;
        margin: 1em 0;
      }
    }

    /* Markdown content styling - fully theme-aware */
    .prose h1 {
      font-size: 2.25rem;
      font-weight: 700;
      color: var(--f2);
      margin-bottom: 2rem;
      margin-top: 3rem;
      padding-bottom: 0.75rem;
      border-bottom: 3px solid color-mix(in srgb, var(--a1) 30%, transparent);
      background: linear-gradient(to right, color-mix(in srgb, var(--a1) 10%, transparent), transparent);
      padding-left: 0.5rem;
      margin-left: -0.5rem;
    }
    .prose h2 {
      font-size: 1.875rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      margin-top: 3rem;
      border-bottom: 2px solid color-mix(in srgb, var(--a1) 30%, transparent);
      padding-bottom: 0.75rem;
      color: var(--a1);
    }
    .prose h3 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--a1);
      margin-bottom: 1rem;
      margin-top: 2rem;
      position: relative;
      padding-left: 1rem;
    }
    .prose h3::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 60%;
      background: linear-gradient(to bottom, var(--a1), color-mix(in srgb, var(--a1) 70%, transparent));
      border-radius: 2px;
    }
    .prose h4 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--a1);
      margin-bottom: 0.75rem;
      margin-top: 1.5rem;
    }
    .prose p {
      color: var(--f1);
      line-height: 1.75;
      font-size: 1.0625rem;
      margin-bottom: 1.5em;
    }
    .prose a {
      color: var(--a1);
      text-decoration: underline;
      transition: color 0.2s;
    }
    .prose a:hover {
      color: var(--a1-hover);
    }
    .prose ul {
      list-style: disc;
      color: var(--f1);
      list-style-position: outside;
      padding-left: 2rem;
      margin-bottom: 1.5em;
    }
    .prose ol {
      list-style: decimal;
      color: var(--f1);
      list-style-position: outside;
      padding-left: 2rem;
      margin-bottom: 1.5em;
    }
    .prose li {
      padding-left: 0.5rem;
      text-indent: 0;
      margin-bottom: 0.25em;
    }
    .prose li::marker {
      color: var(--a1);
    }
    .prose blockquote {
      border-left: 4px solid var(--a1);
      padding-left: 1.5rem;
      font-style: italic;
      color: var(--c4);
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
      background: color-mix(in srgb, var(--a1) 5%, transparent);
      margin: 1.5em 0;
    }
    .prose pre {
      margin: 1.5em 0;
    }
    .prose table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5em 0;
    }
    .prose th {
      background-color: var(--c2);
      color: var(--f2);
      padding: 0.75rem;
      border: 1px solid var(--c3);
      text-align: left;
      font-weight: 600;
    }
    .prose td {
      padding: 0.75rem;
      border: 1px solid var(--c3);
      color: var(--f1);
    }
    .prose hr {
      margin: 2rem 0;
      border-color: var(--c3);
      border-top-width: 2px;
    }
    .prose strong {
      color: var(--f2);
      font-weight: 600;
    }

    /* Theme toggle button styling */
    .theme-toggle {
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 0.375rem;
      background: transparent;
      border: 1px solid var(--c3);
      color: var(--c4);
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 2.25rem;
      height: 2.25rem;
    }
    .theme-toggle:hover {
      color: var(--a1);
      border-color: var(--a1);
    }
    .theme-toggle svg {
      width: 1.25rem;
      height: 1.25rem;
    }
    /* Show/hide icons based on theme */
    .theme-toggle .icon-sun { display: none; }
    .theme-toggle .icon-moon { display: block; }
    [data-theme="dark"] .theme-toggle .icon-sun { display: block; }
    [data-theme="dark"] .theme-toggle .icon-moon { display: none; }

    /* Background grid - theme-aware */
    .bg-grid {
      background-image: linear-gradient(var(--grid-color) 1px, transparent 1px),
                        linear-gradient(to right, var(--grid-color) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* KaTeX math styling - theme-aware */
    .katex {
      font-size: 1.1em;
      color: var(--f1);
    }
    .katex-display {
      margin: 1.5em 0;
      padding: 1rem;
      background: color-mix(in srgb, var(--c2) 60%, transparent);
      border-radius: 0.5rem;
      border: 1px solid var(--c3);
      overflow-x: auto;
    }
    .katex-display > .katex {
      color: var(--f2);
    }
    /* Accent color for key symbols */
    .katex .mord.text,
    .katex .mop {
      color: var(--a1);
    }
  </style>

  <!-- Theme initialization script (runs before page render to prevent flash) -->
  <script>
    (function() {
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = savedTheme || (prefersDark ? 'dark' : 'light');
      if (theme === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
    })();
  </script>

  {% block extra_head %}{% endblock extra_head %}
</head>
<body>

  <!-- Background Grid Effect - now theme-aware -->
  <div class="fixed inset-0 z-0 opacity-20 pointer-events-none bg-grid"></div>

  {% block content %}{% endblock content %}

  <!-- Theme toggle script -->
  <script>
    function toggleTheme() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      const newTheme = isDark ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    }

    // Expose globally for onclick handlers
    window.toggleTheme = toggleTheme;
  </script>

  <!-- KaTeX auto-render initialization -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      if (typeof renderMathInElement !== 'undefined') {
        renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\(', right: '\\)', display: false},
            {left: '\\[', right: '\\]', display: true}
          ],
          throwOnError: false,
          trust: true
        });
      }
    });
  </script>

</body>
</html>
